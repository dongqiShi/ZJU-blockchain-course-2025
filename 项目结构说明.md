# 📁 项目结构说明

## 完整项目结构

```
ZJU-blockchain-course-2025/
│
├── contracts/                              # 智能合约目录
│   ├── contracts/                          # Solidity 合约源码
│   │   ├── BetToken.sol                   # ✅ ERC20 积分代币合约
│   │   ├── BetTicket.sol                  # ✅ ERC721 彩票凭证合约
│   │   ├── BettingSystem.sol              # ✅ 主彩票系统合约
│   │   └── EasyBet.sol                    # （原始模板，可忽略）
│   │
│   ├── scripts/                           # 部署和工具脚本
│   │   ├── deploy.ts                      # ✅ 自动化部署脚本
│   │   └── update-frontend-config.js      # ✅ 前端配置更新工具
│   │
│   ├── test/                              # 测试文件（可自行添加）
│   │   └── testEasyBet.ts
│   │
│   ├── artifacts/                         # 编译产物（自动生成）
│   │   └── contracts/                     # 包含 ABI 和字节码
│   │
│   ├── typechain-types/                   # TypeScript 类型定义（自动生成）
│   │
│   ├── cache/                             # 编译缓存（自动生成）
│   │
│   ├── hardhat.config.ts                  # ⚙️ Hardhat 配置文件
│   ├── tsconfig.json                      # TypeScript 配置
│   ├── package.json                       # Node.js 依赖配置
│   ├── package-lock.json                  # 依赖锁定文件
│   └── contract-addresses.json            # 📝 部署后的合约地址（自动生成）
│
├── frontend/                              # 前端应用目录
│   ├── public/                            # 静态资源
│   │   ├── index.html                     # HTML 模板
│   │   ├── favicon.ico                    # 网站图标
│   │   └── ...
│   │
│   ├── src/                               # 源代码
│   │   ├── contracts/                     # 合约配置
│   │   │   ├── addresses.ts               # ✅ 合约地址配置
│   │   │   └── abis.ts                    # ✅ 合约 ABI 定义
│   │   │
│   │   ├── App.tsx                        # ✅ 主应用组件（核心逻辑）
│   │   ├── App.css                        # ✅ 应用样式
│   │   ├── index.tsx                      # React 入口
│   │   ├── index.css                      # 全局样式
│   │   ├── react-app-env.d.ts            # React 类型定义
│   │   └── ...
│   │
│   ├── node_modules/                      # 依赖包（自动生成）
│   ├── package.json                       # 依赖配置
│   ├── package-lock.json                  # 依赖锁定
│   └── tsconfig.json                      # TypeScript 配置
│
├── README.md                              # 📖 项目说明（已完善）
├── 使用说明文档.md                        # 📚 详细使用教程（50+ 页）
├── 快速启动指南.md                        # 🚀 快速参考
├── 项目总结.md                            # 📊 项目总结
└── 项目结构说明.md                        # 📁 本文档
```

## 🎯 核心文件说明

### 智能合约文件

#### 1. BetToken.sol
**作用**: ERC20 积分代币合约

**主要功能**:
- `claimTokens()`: 用户领取免费代币
- `getRemainingClaims()`: 查询剩余领取次数
- 标准 ERC20 功能（transfer, approve, balanceOf 等）

**关键特性**:
- 每次领取 1000 BET
- 每地址最多领取 10 次
- 使用 OpenZeppelin ERC20 标准

#### 2. BetTicket.sol
**作用**: ERC721 彩票凭证合约

**主要功能**:
- `mintTicket()`: 铸造彩票 NFT（仅系统调用）
- `getTicketInfo()`: 查询彩票信息
- `getTicketsOfOwner()`: 查询用户所有彩票
- 标准 ERC721 功能

**关键特性**:
- 每张彩票是唯一的 NFT
- 记录项目 ID 和选项索引
- 支持转让和交易

#### 3. BettingSystem.sol
**作用**: 主彩票系统合约（核心业务逻辑）

**主要功能**:
- `createProject()`: 创建竞猜项目
- `purchaseTicket()`: 购买彩票
- `createSellOrder()`: 创建出售订单
- `buyTicketFromOrder()`: 购买订单中的彩票
- `settleProject()`: 结算项目
- `claimReward()`: 领取奖励
- `getProjectInfo()`: 查询项目信息
- `getProjectOrders()`: 查询订单簿

**关键特性**:
- 管理项目生命周期
- 实现链上订单簿
- 处理奖励分配
- ReentrancyGuard 防护

### 部署脚本

#### deploy.ts
**作用**: 自动化部署所有合约

**流程**:
1. 部署 BetToken
2. 部署 BetTicket
3. 部署 BettingSystem
4. 转移 BetTicket 所有权给 BettingSystem
5. 保存合约地址到 `contract-addresses.json`

#### update-frontend-config.js
**作用**: 同步合约地址到前端

**流程**:
1. 读取 `contract-addresses.json`
2. 更新 `frontend/src/contracts/addresses.ts`
3. 确保前端使用最新的合约地址

### 前端文件

#### App.tsx
**作用**: 主应用组件（2000+ 行代码）

**功能模块**:
1. **钱包连接**: MetaMask 集成
2. **所有项目**: 浏览和购买彩票
3. **创建项目**: 公证人创建竞猜
4. **我的彩票**: 管理和出售彩票
5. **交易市场**: 订单簿查看和购买

**核心 Hooks**:
- `useState`: 管理应用状态
- `useEffect`: 监听账户变化
- 自定义加载函数（loadBalance, loadProjects 等）

#### App.css
**作用**: 应用样式（800+ 行 CSS）

**设计特点**:
- 渐变色主题（紫色系）
- 响应式设计
- 卡片式布局
- 现代化 UI 组件

#### contracts/addresses.ts
**作用**: 合约地址配置

**内容**:
```typescript
export const CONTRACT_ADDRESSES = {
  BetToken: "0x...",
  BetTicket: "0x...",
  BettingSystem: "0x..."
};
```

#### contracts/abis.ts
**作用**: 合约 ABI 定义

**内容**: 使用 ethers.js 的 Human-Readable ABI 格式

### 配置文件

#### hardhat.config.ts
**作用**: Hardhat 开发环境配置

**配置内容**:
- Solidity 版本: 0.8.20
- Ganache 网络配置
- 账户私钥设置

#### package.json（contracts）
**主要依赖**:
- hardhat: ^2.26.3
- @openzeppelin/contracts: ^5.0.0
- @nomicfoundation/hardhat-toolbox: ^2.0.2

#### package.json（frontend）
**主要依赖**:
- react: ^19.2.0
- ethers: ^5.7.2
- typescript: ^4.9.5

## 📝 文档文件

### README.md
- 项目简介
- 运行步骤
- 功能实现分析

### 使用说明文档.md
- 详细安装配置（50+ 页）
- 完整使用教程
- 常见问题解答
- 测试流程示例

### 快速启动指南.md
- 一页快速参考
- 常见问题速查

### 项目总结.md
- 项目概况
- 技术架构
- 核心亮点

### 项目结构说明.md
- 本文档
- 项目文件树
- 核心文件说明

## 🔄 文件依赖关系

```
部署流程:
deploy.ts
  → 部署三个合约
  → 生成 contract-addresses.json
  → update-frontend-config.js
    → 更新 frontend/src/contracts/addresses.ts

运行流程:
Ganache (本地链)
  ↓
hardhat.config.ts (连接配置)
  ↓
BettingSystem.sol (调用)
  ↓
BetToken.sol & BetTicket.sol (依赖)
  ↓
frontend/App.tsx (通过 ethers.js)
  ↓
MetaMask (用户钱包)
```

## 📊 代码统计

| 文件 | 行数 | 说明 |
|------|------|------|
| BetToken.sol | ~50 | ERC20 合约 |
| BetTicket.sol | ~80 | ERC721 合约 |
| BettingSystem.sol | ~400 | 主系统合约 |
| App.tsx | ~600 | 前端主组件 |
| App.css | ~500 | 样式文件 |
| deploy.ts | ~60 | 部署脚本 |

**总计**: ~1,700 行核心代码

## 🎯 关键路径

### 第一次运行
1. `contracts/hardhat.config.ts` - 配置 Ganache
2. `contracts/scripts/deploy.ts` - 部署合约
3. `contracts/scripts/update-frontend-config.js` - 更新配置
4. `frontend/src/App.tsx` - 启动前端

### 日常开发
1. 修改合约 → `npx hardhat compile`
2. 重新部署 → `npx hardhat run scripts/deploy.ts --network ganache`
3. 更新配置 → `node scripts/update-frontend-config.js`
4. 重启前端 → `npm start`

## 💡 最佳实践

### 开发建议
1. **修改合约后必须**:
   - 重新编译
   - 重新部署
   - 更新前端配置
   - 重启前端

2. **切换网络时**:
   - 检查 MetaMask 网络
   - 确认 RPC 地址
   - 验证合约地址

3. **遇到问题时**:
   - 查看浏览器控制台
   - 检查 MetaMask 连接
   - 确认账户余额

### 文件管理
- ✅ 保留: 所有 .sol, .ts, .tsx 文件
- ✅ 可删除重新生成: artifacts/, cache/, typechain-types/, node_modules/
- ⚠️ 注意: contract-addresses.json 包含部署地址，删除后需重新部署

## 🎓 学习路径

**新手**: 
1. 阅读 `快速启动指南.md`
2. 按步骤运行项目
3. 查看 `使用说明文档.md` 了解功能

**进阶**:
1. 阅读 `BettingSystem.sol` 理解业务逻辑
2. 研究 `App.tsx` 学习 Web3 前端
3. 修改功能并重新部署测试

**专家**:
1. 扩展合约功能（添加新的竞猜类型）
2. 优化订单簿性能
3. 添加更多前端功能（图表、统计等）

---

项目结构清晰，文档完整，适合学习和扩展！

